<% include ./partials/header2 %>

    <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>
        Films
      <small>Add / Edit / Delete</small>
        </h1>
      <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
        <li class="active">Films</li>
      </ol>
    </section>
    <!-- Main content -->
    <section class="content">
        <div class="row">
            <div class="col-xs-12">
              <div class="box">
                <div class="box-header">
                  <h3 class="box-title">
                    <button type="button" class="btn btn-info" data-toggle="modal" data-target="#modal-User" onclick="userAction('','add')">
                    <i class="fa fa-fw fa-user-plus"></i>
                    </button>
                  </h3>
                </div>
                <div class="box-body">

                    <table id="dt" class="display" style="width:100%">
                        <thead>
                            <tr>
                                <th>Id</th>
                                <th>Name</th>
                                <th>Description</th>
                                <th>Status</th>
                                <th>Edit / Delete</th>
                            </tr>
                        </thead>
                        
                    </table>
                   
                  
                    
                  </div>
                  <!-- /.box-body -->
                </div>
                <!-- /.box -->
              </div>
              <!-- /.col -->
            </div>
            <!-- /.row -->

    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->

  <div class="modal fade" id="modal-User">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="modalTitle">Add New User</h4>

                
            
          </div>
          <div class="modal-body">
            <!-- form start -->
              <form class="form-horizontal" id="modalForm" enctype="multipart/form-data" action="/api/films/add" method="POST">
                <div class="alert"></div>
                <div class="box-body">
  <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">Film Name</label>
  
                    <div class="col-sm-10">
                     <input type="text" id="name" name="name" class="form-control" placeholder="Name">
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">Description</label>
  
                    <div class="col-sm-10">
                      <input type="hidden" id="_id" name="_id">
                      <input type="text" id="description" name="description" class="form-control" placeholder="Description">
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">Rating.</label>
  
                    <div class="col-sm-10">
                    <select name="rating" class="form-control" id="rating">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    </select>
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">Ticket Price</label>
  
                    <div class="col-sm-10">
                     <input type="text" id="ticket_price" name="ticket_price" class="form-control" placeholder="Ticket Price">
                    </div>
                  </div>


                  <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">Country</label>
  
                    <div class="col-sm-10">
                    <select name="country" class="form-control" id="country">
                    <option value="Pakistan">Pakistan</option>
                    <option value="United States">United States</option>
                    </select>

                    </div>
                  </div>
                  
                   <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">Release Date</label>
  
                    <div class="col-sm-10">
                     <input type="text" id="release_date" name="release_date" class="form-control" placeholder="Release date">
                    </div>
                  </div>
                  

                  <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">Genre (Please add coma seperated values)</label>
  
                    <div class="col-sm-10">
                     <input type="text" id="genre" name="genre" class="form-control" placeholder="Genre">
                    </div>
                  </div>
                                    <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">Photo</label>
  
                    <div class="col-sm-10">
              <input type="file" name="photo" id="photo" accept="image/*" class="form-control">
                    </div>
                  </div>

                                  <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">Status</label>
  
                    <div class="col-sm-10">
                      <select name="status" id="status" class="form-control">
                        <option value="1">Enabled</option>
                        <option value="2">Disabled</option>
                      </select>
                    </div>
                  </div>
                  
                  
                </div>
                <!-- /.box-body -->
                <div class="box-footer">
                  <button type="button" data-dismiss="modal" class="btn btn-default">Cancel</button>
                  <button type="button" id="modalSubmit" class="btn btn-info pull-right">Add</button>
                </div>
                <!-- /.box-footer -->
              </form>
          </div>
        </div>
        <!-- /.modal-content -->
      </div>
      <!-- /.modal-dialog -->
    </div>
    <!-- /.modal -->
    
  
  <% include ./partials/footer %>
  
  <link rel="stylesheet" type="text/css" href="/datatable/css/jquery.dataTables.css">
  <script type="text/javascript" language="javascript" src="/datatable/js/jquery.dataTables.js"></script>
  <script type="text/javascript" language="javascript" src="/datatable/js/dataTables.buttons.min.js"></script>
  <script type="text/javascript" language="javascript" src="/datatable/js/jszip.min.js"></script>
  <script type="text/javascript" language="javascript" src="/datatable/js/pdfmake.min.js"></script>
  <script type="text/javascript" language="javascript" src="/datatable/js/vfs_fonts.js"></script>
    <script type="text/javascript" language="javascript" src="/datatable/js/buttons.html5.min.js"></script>
    <script type="text/javascript" language="javascript" src="/global.js"></script>
  <script>
$(document).ready(function() {
  $('#dt').DataTable( {
    "pageLength": 1,
    "ajax":  base_url+'api/films/getAll',
    "columns": [
      { "data": "Id" },
      { "data": "Name" },
      { "data": "Description" },
            { "data": "Status" },
            {
                    orderable: false,
                    className: 'text-right',
                    render: function (data, type, row) {
                        console.log(data,type,row)
                        return '<a class="btn btn-danger" data-id="' + row.Id + '"  onclick="delAction('+row.Id+')">' +
                            '<span class="glyphicon glyphicon-trash"> </span>' +
                            '</a>'
                        +
                            '<a class="btn btn-primary" data-id="' + row.Id + '"   onclick="showAction('+row.Id+')">' +
                            '<span class="glyphicon glyphicon-eye-open"> </span>' +
                            '</a>'
                    }
                }
        ],
        select: true,
        dom: 'Bfrtip',
        buttons: [
            'excelHtml5',
            'csvHtml5',
            'pdfHtml5'
        ]
    } );
    // on clicke modalSubmit
    $( "#modalSubmit" ).click(function() {
        const $form = $('#modalForm')
        let id = $('#_id').val();
        let url = base_url+'api/films/add';
        if(id){
           url = base_url+'api/films/update';
        }
        $.ajax({
        type:'POST',
        data: $form.serialize(),
        url: url,
        enctype: 'multipart/form-data',
        success: function (data) {
            ajax_repsonse(data);
            
        }
      });
    });

   
});
    function delAction(id){
        $.ajax({
        type:'GET',
        url: base_url+'api/films/del/'+id,
        success: function (data) {
            ajax_repsonse(data);
        }
        });
    }

    function showAction(id){
        //alert(id);
        //var url = 'films/'+slug;
        //window.location = url;
        $.ajax({
        type:'GET',
        url: base_url+'api/films/get/'+id,
        success: function (data) {
          if(data){
            //console.log(data[0].slug);
            window.location='films/'+data[0].slug;
          }
        }
        });

    }

    function editAction(id){
      $.ajax({
        type:'GET',
        url: base_url+'api/films/get/'+id,
        success: function (data) {
          if(data){
            $('#status').val('')
            $('#modalTitle').html("Edit  Mobile Category");
            $('#modalSubmit').html("Update");
            $('#modal-User').modal('show');
            $('#name').val(data.name);
            $('#description').val(data.description);
            $('#_id').val(data.id);
            let status = data.status;
            $("#status").val(status);
            //$('#status option[value='+status+']').attr('selected','selected');
          }
        }
        });
    }
    function userAction(id,action){
    
    if(action == 'add')
    {
        $('#modalTitle').html("Add New Film");
        $('#modalSubmit').html("Add");
        //$('#modalForm').attr('action', '/api/films/add');
    }
    else if(action == 'edit')
    {
        $.ajax({
        type: 'GET',
        url: base_url+'/admin/user/'+id,
        success: function (data) {
            $('#_id').val(data.data.users[0]._id);
            $('#email').val(data.data.users[0].email);
            $('#password').val(data.data.users[0].password);
            
            $('#modalTitle').html(data.data.modalTitle);
            $('#modalSubmit').html(data.data.modalSubmit);
            $('#modalForm').attr('action', '/admin/user/'+id);
        }
        });
    }
    else if(action == 'delete')
    {
        $.ajax({
        type: 'DELETE',
        url: base_url+'/admin/user/'+id,
        success: function (data) {
            location.reload();
        }
        });
    }
    }
      </script>